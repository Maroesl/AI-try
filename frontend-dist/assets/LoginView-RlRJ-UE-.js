import{d as S,u as U,r as v,o as $,a as q,c as o,b as s,e as d,w as f,f as c,v as _,t as h,g as k,h as A,i as l,_ as D}from"./index-CNFTjEvq.js";const M={class:"login-container"},B={class:"login-card"},N={key:0,class:"loading-state"},R={key:1,class:"login-content"},F={key:0,class:"login-section"},I={key:1,class:"divider"},P={key:2,class:"login-section"},T={class:"form-group"},W=["disabled"],z={class:"form-group"},E=["disabled"],O={key:0,class:"error-message"},Y=["disabled"],j={key:0},G={key:1},H={key:1,class:"register-link"},J={class:"modal-header"},K={class:"form-group"},Q=["disabled"],X={class:"form-group"},Z=["disabled"],ee={class:"form-group"},se=["disabled"],oe={key:0,class:"error-message"},le=["disabled"],te={key:0},ae=S({__name:"LoginView",setup(ne){const g=q(),b=U(),r=v({linux_do_enabled:!1,linux_do_client_id:"",linux_do_redirect_uri:"",local_auth_enabled:!0,registration_enabled:!0}),p=v({username:"",password:""}),u=v({username:"",password:"",name:""}),y=v(!0),t=v(!1),i=v(""),m=v(!1),x=async()=>{try{const a=await b.getAuthConfig();a&&(r.value=a)}catch(a){console.error("获取认证配置失败:",a)}finally{y.value=!1}},C=()=>{if(!r.value.linux_do_enabled){i.value="Linux.do OAuth 未配置";return}const a=`https://connect.linux.do/oauth2/authorize?client_id=${r.value.linux_do_client_id}&redirect_uri=${r.value.linux_do_redirect_uri}&response_type=code&scope=user`;window.location.href=a},w=async()=>{i.value="",t.value=!0;try{await b.loginWithPassword(p.value.username,p.value.password)?g.push("/"):i.value="用户名或密码错误"}catch(a){i.value="登录失败，请稍后重试",console.error("登录失败:",a)}finally{t.value=!1}},V=async()=>{i.value="",t.value=!0;try{await b.register(u.value.username,u.value.password,u.value.name)?(m.value=!1,await w()):i.value="注册失败，用户名可能已存在"}catch(a){i.value="注册失败，请检查输入信息",console.error("注册失败:",a)}finally{t.value=!1}};return $(()=>{if(b.isLoggedIn){g.push("/");return}x()}),(a,e)=>{const L=A('else"');return l(),o("div",M,[s("div",B,[e[19]||(e[19]=s("div",{class:"login-header"},[s("h1",{class:"login-title"},"YPrompt"),s("p",{class:"login-subtitle"},"提示词管理系统")],-1)),y.value?(l(),o("div",N,[...e[9]||(e[9]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"正在加载...",-1)])])):(l(),o("div",R,[r.value.linux_do_enabled?(l(),o("div",F,[s("button",{onClick:C,class:"btn btn-primary btn-linux-do"}," 使用 Linux.do 登录 ")])):d("",!0),r.value.linux_do_enabled&&r.value.local_auth_enabled?(l(),o("div",I,[...e[10]||(e[10]=[s("span",null,"或",-1)])])):d("",!0),r.value.local_auth_enabled?(l(),o("div",P,[s("form",{onSubmit:f(w,["prevent"]),class:"login-form"},[s("div",T,[e[11]||(e[11]=s("label",{for:"username"},"用户名",-1)),c(s("input",{id:"username","onUpdate:modelValue":e[0]||(e[0]=n=>p.value.username=n),type:"text",class:"form-input",placeholder:"请输入用户名",disabled:t.value,required:""},null,8,W),[[_,p.value.username]])]),s("div",z,[e[12]||(e[12]=s("label",{for:"password"},"密码",-1)),c(s("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=n=>p.value.password=n),type:"password",class:"form-input",placeholder:"请输入密码",disabled:t.value,required:""},null,8,E),[[_,p.value.password]])]),i.value?(l(),o("div",O,h(i.value),1)):d("",!0),s("button",{type:"submit",class:"btn btn-primary btn-block",disabled:t.value},[t.value?(l(),o("span",j,"登录中...")):(l(),o("span",G,"登录"))],8,Y),r.value.registration_enabled?(l(),o("div",H,[e[13]||(e[13]=k(" 还没有账号？ ",-1)),s("a",{onClick:e[2]||(e[2]=f(n=>m.value=!0,["prevent"])),href:"#"},"立即注册")])):d("",!0)],32)])):d("",!0),m.value?(l(),o("div",{key:3,class:"modal-overlay",onClick:e[8]||(e[8]=n=>m.value=!1)},[s("div",{class:"modal-content",onClick:e[7]||(e[7]=f(()=>{},["stop"]))},[s("div",J,[e[14]||(e[14]=s("h2",null,"注册新账号",-1)),s("button",{onClick:e[3]||(e[3]=n=>m.value=!1),class:"modal-close"},"×")]),s("form",{onSubmit:f(V,["prevent"]),class:"register-form"},[s("div",K,[e[15]||(e[15]=s("label",{for:"reg-username"},"用户名",-1)),c(s("input",{id:"reg-username","onUpdate:modelValue":e[4]||(e[4]=n=>u.value.username=n),type:"text",class:"form-input",placeholder:"3-20个字符，字母开头",disabled:t.value,required:""},null,8,Q),[[_,u.value.username]])]),s("div",X,[e[16]||(e[16]=s("label",{for:"reg-password"},"密码",-1)),c(s("input",{id:"reg-password","onUpdate:modelValue":e[5]||(e[5]=n=>u.value.password=n),type:"password",class:"form-input",placeholder:"至少8个字符，包含字母和数字",disabled:t.value,required:""},null,8,Z),[[_,u.value.password]])]),s("div",ee,[e[17]||(e[17]=s("label",{for:"reg-name"},"显示名称（可选）",-1)),c(s("input",{id:"reg-name","onUpdate:modelValue":e[6]||(e[6]=n=>u.value.name=n),type:"text",class:"form-input",placeholder:"留空则使用用户名",disabled:t.value},null,8,se),[[_,u.value.name]])]),i.value?(l(),o("div",oe,h(i.value),1)):d("",!0),s("button",{type:"submit",class:"btn btn-primary btn-block",disabled:t.value},[t.value?(l(),o("span",te,"注册中...")):d("",!0),c((l(),o("span",null,[...e[18]||(e[18]=[k("注册",-1)])])),[[L]])],8,le)],32)])])):d("",!0)]))])])}}}),re=D(ae,[["__scopeId","data-v-3b1e44a2"]]);export{re as default};
